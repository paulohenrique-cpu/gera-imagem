<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Gerador de Imagem - Editor Visual</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
      background-attachment: fixed;
      min-height: 100vh;
      color: #333;
      position: relative;
      overflow-x: hidden;
    }

    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: 
        radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.3) 0%, transparent 50%),
        radial-gradient(circle at 40% 40%, rgba(120, 219, 255, 0.2) 0%, transparent 50%);
      pointer-events: none;
      z-index: -1;
    }

    .header-logo {
      background: rgba(255, 255, 255, 0.98);
      backdrop-filter: blur(20px);
      padding: 20px 0;
      text-align: center;
      box-shadow: 0 8px 32px rgba(0,0,0,0.1);
      border-bottom: 1px solid rgba(255, 255, 255, 0.2);
      position: relative;
      z-index: 100;
    }

    .header-logo::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
      pointer-events: none;
    }

    .header-logo a {
      display: inline-block;
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      position: relative;
      z-index: 1;
    }

    .header-logo a:hover {
      transform: scale(1.08) rotate(2deg);
      filter: drop-shadow(0 10px 20px rgba(102, 126, 234, 0.3));
    }

    .header-logo img {
      height: 70px;
      width: auto;
      filter: drop-shadow(0 4px 8px rgba(0,0,0,0.1));
    }

    .menu-topo {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      padding: 20px 0;
      box-shadow: 0 8px 32px rgba(0,0,0,0.1);
      display: flex;
      justify-content: center;
      gap: 15px;
      flex-wrap: wrap;
      border-bottom: 1px solid rgba(255, 255, 255, 0.2);
      position: relative;
      z-index: 99;
    }

    .menu-topo a {
      color: #4a5568;
      text-decoration: none;
      padding: 12px 24px;
      border-radius: 50px;
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      font-weight: 600;
      font-size: 14px;
      background: rgba(255, 255, 255, 0.8);
      border: 2px solid transparent;
      position: relative;
      overflow: hidden;
    }

    .menu-topo a::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
      transition: left 0.5s;
    }

    .menu-topo a:hover::before {
      left: 100%;
    }

    .menu-topo a:hover {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      transform: translateY(-3px) scale(1.05);
      box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
      border-color: rgba(255, 255, 255, 0.3);
    }

    .offline-indicator {
      background: #f56565;
      color: white;
      padding: 10px;
      text-align: center;
      display: none;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.7; }
      100% { opacity: 1; }
    }

    h1 {
      text-align: center;
      color: white;
      margin: 40px 0;
      font-size: 3rem;
      font-weight: 800;
      text-shadow: 0 4px 20px rgba(0,0,0,0.3);
      background: linear-gradient(135deg, #ffffff 0%, #f0f8ff 50%, #e6f3ff 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      position: relative;
      animation: titleGlow 3s ease-in-out infinite alternate;
    }

    @keyframes titleGlow {
      0% {
        filter: drop-shadow(0 0 10px rgba(255,255,255,0.3));
      }
      100% {
        filter: drop-shadow(0 0 20px rgba(255,255,255,0.6));
      }
    }

    .container {
      display: grid;
      grid-template-columns: 1fr 2fr;
      gap: 30px;
      max-width: 1400px;
      margin: 0 auto;
      padding: 0 20px;
    }

    .controls-panel {
      background: rgba(255, 255, 255, 0.98);
      backdrop-filter: blur(25px);
      border-radius: 25px;
      padding: 35px;
      box-shadow: 
        0 20px 60px rgba(0,0,0,0.1),
        0 0 0 1px rgba(255,255,255,0.2),
        inset 0 1px 0 rgba(255,255,255,0.3);
      height: fit-content;
      max-height: 80vh;
      overflow-y: auto;
      position: relative;
      border: 1px solid rgba(255, 255, 255, 0.3);
    }

    .controls-panel::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
      border-radius: 25px;
      pointer-events: none;
    }

    .controls-panel::-webkit-scrollbar {
      width: 8px;
    }

    .controls-panel::-webkit-scrollbar-track {
      background: rgba(0,0,0,0.05);
      border-radius: 10px;
    }

    .controls-panel::-webkit-scrollbar-thumb {
      background: linear-gradient(135deg, #667eea, #764ba2);
      border-radius: 10px;
    }

    .controls-panel::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(135deg, #5a67d8, #6b46c1);
    }

    .control-group {
      margin-bottom: 30px;
      padding: 25px;
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.08) 0%, rgba(118, 75, 162, 0.05) 100%);
      border-radius: 20px;
      border: 1px solid rgba(102, 126, 234, 0.15);
      position: relative;
      transition: all 0.3s ease;
      overflow: hidden;
    }

    .control-group::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 4px;
      height: 100%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 0 2px 2px 0;
    }

    .control-group::after {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(102, 126, 234, 0.03) 0%, transparent 70%);
      opacity: 0;
      transition: opacity 0.3s ease;
      pointer-events: none;
    }

    .control-group:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 30px rgba(102, 126, 234, 0.15);
      border-color: rgba(102, 126, 234, 0.25);
    }

    .control-group:hover::after {
      opacity: 1;
    }

    .control-group h3 {
      color: #2d3748;
      margin-bottom: 20px;
      font-size: 1.2rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 12px;
      position: relative;
      z-index: 1;
    }

    label {
      display: block;
      margin-bottom: 8px;
      color: #4a5568;
      font-weight: 500;
    }

    input, select, textarea {
      width: 100%;
      padding: 12px 15px;
      border: 2px solid #e2e8f0;
      border-radius: 10px;
      font-size: 14px;
      transition: all 0.3s ease;
      background: white;
    }

    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .color-font-controls {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin-top: 10px;
    }

    .color-picker {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    input[type="color"] {
      width: 50px;
      height: 40px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }

    .font-selector {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .size-controls {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
    }

    .canvas-area {
      background: rgba(255, 255, 255, 0.98);
      backdrop-filter: blur(25px);
      border-radius: 25px;
      padding: 35px;
      box-shadow: 
        0 20px 60px rgba(0,0,0,0.1),
        0 0 0 1px rgba(255,255,255,0.2),
        inset 0 1px 0 rgba(255,255,255,0.3);
      position: relative;
      border: 1px solid rgba(255, 255, 255, 0.3);
    }

    .canvas-area::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
      border-radius: 25px;
      pointer-events: none;
    }

    .canvas {
      width: 100%;
      height: 1000px;
      background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
      border: 3px dashed rgba(102, 126, 234, 0.3);
      border-radius: 20px;
      position: relative;
      overflow: hidden;
      transition: all 0.3s ease;
      box-shadow: inset 0 2px 10px rgba(0,0,0,0.05);
    }

    .canvas:hover {
      border-color: rgba(102, 126, 234, 0.5);
      box-shadow: 
        inset 0 2px 10px rgba(0,0,0,0.05),
        0 0 20px rgba(102, 126, 234, 0.1);
    }

    .draggable-element {
      position: absolute;
      cursor: move;
      user-select: none;
      border: 2px solid transparent;
      transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      border-radius: 12px;
    }

    .draggable-element:hover {
      border-color: rgba(102, 126, 234, 0.6);
      transform: scale(1.02);
      box-shadow: 0 5px 20px rgba(102, 126, 234, 0.2);
    }

    .draggable-element.selected {
      border-color: #667eea;
      box-shadow: 
        0 0 0 3px rgba(102, 126, 234, 0.3),
        0 8px 25px rgba(102, 126, 234, 0.2);
      transform: scale(1.02);
    }

    .draggable-text {
      padding: 10px;
      background: rgba(255, 255, 255, 0.9);
      border-radius: 8px;
      min-width: 100px;
      min-height: 40px;
      font-size: 16px;
      color: #333;
    }

    .draggable-image {
      border-radius: 8px;
      max-width: 300px;
      max-height: 300px;
    }

    .draggable-price {
      padding: 15px 20px;
      background: rgba(229, 62, 62, 0.1);
      border-radius: 12px;
      min-width: 120px;
      min-height: 50px;
      font-size: 35px;
      font-weight: bold;
      color: #e53e3e;
      text-align: center;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .resize-handle {
      position: absolute;
      width: 12px;
      height: 12px;
      background: #667eea;
      border: 2px solid white;
      border-radius: 50%;
      cursor: nw-resize;
      bottom: -6px;
      right: -6px;
      display: none;
    }

    .draggable-element.selected .resize-handle {
      display: block;
    }

    .add-element-btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 14px 24px;
      border-radius: 15px;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      margin: 6px;
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      position: relative;
      overflow: hidden;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.2);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .add-element-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left 0.5s;
    }

    .add-element-btn:hover::before {
      left: 100%;
    }

    .add-element-btn:hover {
      background: linear-gradient(135deg, #5a67d8 0%, #6b46c1 100%);
      transform: translateY(-3px) scale(1.02);
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
    }

    .add-element-btn:active {
      transform: translateY(-1px) scale(0.98);
    }

    .element-controls {
      margin-top: 20px;
      padding: 20px;
      background: rgba(102, 126, 234, 0.05);
      border-radius: 15px;
      display: none;
    }

    .element-controls.active {
      display: block;
    }

    .toolbar {
      margin-bottom: 20px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .product-gallery {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
      gap: 15px;
      margin-top: 15px;
    }

    .product-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 15px;
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(248, 250, 252, 0.9) 100%);
      border-radius: 15px;
      cursor: pointer;
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      border: 2px solid rgba(102, 126, 234, 0.1);
      position: relative;
      overflow: hidden;
    }

    .product-item::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .product-item:hover::before {
      opacity: 1;
    }

    .product-item:hover {
      transform: translateY(-5px) scale(1.05);
      box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
      border-color: rgba(102, 126, 234, 0.4);
    }

    .product-item img {
      width: 60px;
      height: 60px;
      border-radius: 8px;
      object-fit: cover;
      margin-bottom: 8px;
    }

    .product-item span {
      font-size: 12px;
      color: #4a5568;
      text-align: center;
      font-weight: 500;
    }

    .download-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    .download-modal.active {
      display: flex;
    }

    .download-content {
      background: white;
      padding: 30px;
      border-radius: 20px;
      max-width: 500px;
      width: 90%;
      text-align: center;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }

    .download-content h3 {
      color: #4a5568;
      margin-bottom: 20px;
      font-size: 1.5rem;
    }

    .size-options {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin: 20px 0;
    }

    .size-option {
      padding: 15px;
      border: 2px solid #e2e8f0;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s ease;
      background: #f8f9fa;
    }

    .size-option:hover {
      border-color: #667eea;
      background: rgba(102, 126, 234, 0.1);
    }

    .size-option.selected {
      border-color: #667eea;
      background: rgba(102, 126, 234, 0.2);
    }

    .size-option h4 {
      color: #4a5568;
      margin-bottom: 5px;
      font-size: 1.1rem;
    }

    .size-option p {
      color: #718096;
      font-size: 0.9rem;
      margin: 0;
    }

    .format-options {
      display: flex;
      gap: 10px;
      justify-content: center;
      margin: 20px 0;
    }

    .format-btn {
      padding: 10px 20px;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      background: #f8f9fa;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 500;
    }

    .format-btn:hover {
      border-color: #667eea;
      background: rgba(102, 126, 234, 0.1);
    }

    .format-btn.selected {
      border-color: #667eea;
      background: #667eea;
      color: white;
    }

    .download-actions {
      display: flex;
      gap: 15px;
      justify-content: center;
      margin-top: 25px;
    }

    .download-btn {
      padding: 12px 25px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 500;
      transition: all 0.3s ease;
    }

    .download-btn.primary {
      background: #667eea;
      color: white;
    }

    .download-btn.primary:hover {
      background: #5a67d8;
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }

    .download-btn.secondary {
      background: #e2e8f0;
      color: #4a5568;
    }

    .download-btn.secondary:hover {
      background: #cbd5e0;
    }

    @media (max-width: 768px) {
      .container {
        grid-template-columns: 1fr;
        gap: 20px;
      }
      
      h1 {
        font-size: 2rem;
      }

      .size-options {
        grid-template-columns: 1fr;
      }

      .download-actions {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <div class="header-logo">
    <a href="#">
      <img src="https://ik.imagekit.io/ys8l6suo53/Capturar-removebg-preview.png?updatedAt=." alt="Logo Editor Visual">
    </a>
  </div>

  <!-- Menu de Navegação -->
  <nav class="menu-topo">
    <a href="index.html">🏠 Página Inicial</a>
    <a href="editor.html">🎨 Editor Avançado</a>
    <a href="feramentas.html">🛠️ Central de Ferramentas</a>
    <a href="https://www.remove.bg/pt-br/upload" target="_blank">🧼 Remover Fundo</a>
  </nav>

  <div class="offline-indicator" id="offlineIndicator">
    ⚠️ Você está offline. Algumas funcionalidades podem não estar disponíveis.
  </div>

  <h1>🎨 Editor Visual Interativo</h1>

  <div class="container">
    <div class="controls-panel">
      <div class="control-group">
        <h3>🖼️ Fundo do Canvas</h3>
        <div class="form-container">
          <label>Escolha o Fundo:</label>
          <select id="bgSelect" onchange="selecionarFundo(this.value)">
            <option value="upload">📤 Enviar do computador</option>
            <optgroup label="🎨 Fundos Temáticos">
              <option value="https://ik.imagekit.io/ys8l6suo53/123.png?updatedAt=.">🌟 Fundo Elegante 1</option>
              <option value="https://ik.imagekit.io/ys8l6suo53/1234.png?updatedAt=.">✨ Fundo Elegante 2</option>
              <option value="https://ik.imagekit.io/ys8l6suo53/sorteio.jpg?updatedAt=.">🎲 Sorteio</option>
              <option value="https://ik.imagekit.io/ys8l6suo53/mes%20da%20mes.jpg?updatedAt=.">📅 Mês da Mês</option>
              <option value="https://ik.imagekit.io/ys8l6suo53/intagram.jpg?updatedAt=.">📱 Instagram Geral</option>
              <option value="https://ik.imagekit.io/ys8l6suo53/festa%20junina.jpg?updatedAt=.">🎪 Festa Junina</option>
              <option value="https://ik.imagekit.io/ys8l6suo53/black.jpg?updatedAt=.">🖤 Black Oferta</option>
            </optgroup>
            <optgroup label="🌈 Fundos Gradientes">
              <option value="gradient-blue">🔵 Gradiente Azul</option>
              <option value="gradient-purple">🟣 Gradiente Roxo</option>
              <option value="gradient-pink">🩷 Gradiente Rosa</option>
              <option value="gradient-orange">🟠 Gradiente Laranja</option>
              <option value="gradient-green">🟢 Gradiente Verde</option>
              <option value="gradient-sunset">🌅 Pôr do Sol</option>
              <option value="gradient-ocean">🌊 Oceano</option>
              <option value="gradient-forest">🌲 Floresta</option>
            </optgroup>
            <optgroup label="🎯 Fundos Sólidos">
              <option value="solid-white">⚪ Branco</option>
              <option value="solid-black">⚫ Preto</option>
              <option value="solid-red">🔴 Vermelho</option>
              <option value="solid-blue">🔵 Azul</option>
              <option value="solid-green">🟢 Verde</option>
              <option value="solid-yellow">🟡 Amarelo</option>
              <option value="solid-purple">🟣 Roxo</option>
              <option value="solid-pink">🩷 Rosa</option>
            </optgroup>
            <optgroup label="📐 Fundos Geométricos">
              <option value="pattern-dots">🔘 Bolinhas</option>
              <option value="pattern-stripes">📏 Listras</option>
              <option value="pattern-grid">⬜ Grade</option>
              <option value="pattern-triangles">🔺 Triângulos</option>
              <option value="pattern-hexagon">⬡ Hexágonos</option>
              <option value="pattern-waves">🌊 Ondas</option>
            </optgroup>
          </select>
          <input type="file" id="bgUpload" accept="image/*" style="display: none;" onchange="uploadBackground()">
        </div>
      </div>

      <div class="control-group">
        <h3>🛍️ Galeria de Produtos</h3>
        <div class="upload-section" style="margin-bottom: 20px;">
          <button class="add-element-btn" onclick="document.getElementById('productUpload').click()" style="background: #48bb78; width: 100%;">
            📤 Enviar Produto do Computador
          </button>
          <input type="file" id="productUpload" accept="image/*" style="display: none;" onchange="uploadProduct()" multiple>
        </div>
        <div class="product-gallery" id="productGallery">
          <div class="product-item" onclick="addProductImage('https://via.placeholder.com/200x200/ff6b6b/ffffff?text=Produto+1')">
            <img src="https://via.placeholder.com/80x80/ff6b6b/ffffff?text=P1" alt="Produto 1">
            <span>Produto 1</span>
          </div>
          <div class="product-item" onclick="addProductImage('https://via.placeholder.com/200x200/4ecdc4/ffffff?text=Produto+2')">
            <img src="https://via.placeholder.com/80x80/4ecdc4/ffffff?text=P2" alt="Produto 2">
            <span>Produto 2</span>
          </div>
          <div class="product-item" onclick="addProductImage('https://via.placeholder.com/200x200/45b7d1/ffffff?text=Produto+3')">
            <img src="https://via.placeholder.com/80x80/45b7d1/ffffff?text=P3" alt="Produto 3">
            <span>Produto 3</span>
          </div>
          <div class="product-item" onclick="addProductImage('https://via.placeholder.com/200x200/f9ca24/ffffff?text=Produto+4')">
            <img src="https://via.placeholder.com/80x80/f9ca24/ffffff?text=P4" alt="Produto 4">
            <span>Produto 4</span>
          </div>
          <div class="product-item" onclick="addProductImage('https://via.placeholder.com/200x200/6c5ce7/ffffff?text=Produto+5')">
            <img src="https://via.placeholder.com/80x80/6c5ce7/ffffff?text=P5" alt="Produto 5">
            <span>Produto 5</span>
          </div>
          <div class="product-item" onclick="addProductImage('https://via.placeholder.com/200x200/a29bfe/ffffff?text=Produto+6')">
            <img src="https://via.placeholder.com/80x80/a29bfe/ffffff?text=P6" alt="Produto 6">
            <span>Produto 6</span>
          </div>
        </div>
      </div>

      <div class="control-group">
        <h3>🛠️ Ferramentas</h3>
        <div class="toolbar">
          <button class="add-element-btn" onclick="addTextElement()">➕ Adicionar Texto</button>
          <button class="add-element-btn" onclick="addImageElement()">🖼️ Adicionar Imagem</button>
          <button class="add-element-btn" onclick="addPriceElement()">💰 Adicionar Preço</button>
          <button class="add-element-btn" onclick="removeSelectedElement()" style="background: #f56565;">🗑️ Remover Selecionado</button>
          <button class="add-element-btn" onclick="exportLogo()" style="background: #9f7aea;">🎨 Exportar Logo</button>
          <button class="add-element-btn" onclick="showDownloadOptions()" style="background: #48bb78;">📥 Baixar Imagem</button>
        </div>
      </div>

      <div class="control-group">
        <h3>📐 Dimensões do Canvas</h3>
        <div class="size-controls">
          <div>
            <label for="canvasWidth">Largura (px)</label>
            <input type="number" id="canvasWidth" value="1000" min="300" max="1200" onchange="updateCanvasSize()">
          </div>
          <div>
            <label for="canvasHeight">Altura (px)</label>
            <input type="number" id="canvasHeight" value="1000" min="200" max="1200" onchange="updateCanvasSize()">
          </div>
        </div>
      </div></div>

      <div class="element-controls" id="elementControls">
        <h3>✏️ Propriedades do Elemento</h3>
        <div id="textControls" style="display: none;">
          <label for="textContent">Texto</label>
          <textarea id="textContent" rows="3" placeholder="Digite seu texto aqui..." onchange="updateSelectedElement()"></textarea>
          
          <div class="color-font-controls">
            <div class="color-picker">
              <label for="textColor">Cor do Texto</label>
              <input type="color" id="textColor" value="#333333" onchange="updateSelectedElement()">
            </div>
            <div class="font-selector">
              <label for="fontSize">Tamanho da Fonte</label>
              <input type="range" id="fontSize" min="12" max="72" value="16" onchange="updateSelectedElement()">
              <span id="fontSizeValue">16px</span>
            </div>
          </div>
          
          <label for="fontFamily">Família da Fonte</label>
          <select id="fontFamily" onchange="updateSelectedElement()">
            <option value="Arial, sans-serif">Arial</option>
            <option value="Helvetica, sans-serif">Helvetica</option>
            <option value="Georgia, serif">Georgia</option>
            <option value="'Times New Roman', serif">Times New Roman</option>
            <option value="Verdana, sans-serif">Verdana</option>
            <option value="Impact, sans-serif">Impact</option>
            <option value="'Comic Sans MS', cursive">Comic Sans MS</option>
            <option value="'Trebuchet MS', sans-serif">Trebuchet MS</option>
            <option value="Roboto, sans-serif">Roboto</option>
            <option value="'Open Sans', sans-serif">Open Sans</option>
            <option value="Lato, sans-serif">Lato</option>
            <option value="Montserrat, sans-serif">Montserrat</option>
            <option value="Poppins, sans-serif">Poppins</option>
            <option value="Oswald, sans-serif">Oswald</option>
            <option value="Raleway, sans-serif">Raleway</option>
            <option value="Ubuntu, sans-serif">Ubuntu</option>
            <option value="Nunito, sans-serif">Nunito</option>
            <option value="'Source Sans Pro', sans-serif">Source Sans Pro</option>
            <option value="'Playfair Display', serif">Playfair Display</option>
            <option value="Merriweather, serif">Merriweather</option>
            <option value="'Courier New', monospace">Courier New</option>
            <option value="'Lucida Console', monospace">Lucida Console</option>
            <option value="Tahoma, sans-serif">Tahoma</option>
            <option value="'Palatino Linotype', serif">Palatino Linotype</option>
            <option value="'Book Antiqua', serif">Book Antiqua</option>
            <option value="'Century Gothic', sans-serif">Century Gothic</option>
            <option value="'Franklin Gothic Medium', sans-serif">Franklin Gothic Medium</option>
            <option value="'Segoe UI', sans-serif">Segoe UI</option>
            <option value="Calibri, sans-serif">Calibri</option>
            <option value="Cambria, serif">Cambria</option>
          </select>
        </div>

        <div id="imageControls" style="display: none;">
          <label for="imageUrl">URL da Imagem</label>
          <input type="url" id="imageUrl" placeholder="https://exemplo.com/imagem.jpg" onchange="updateSelectedElement()">
          
          <div style="margin: 15px 0;">
            <button class="add-element-btn" onclick="document.getElementById('imageUpload').click()" style="background: #48bb78; width: 100%; margin-bottom: 10px;">
              📤 Trocar por Imagem do Computador
            </button>
            <input type="file" id="imageUpload" accept="image/*" style="display: none;" onchange="uploadImageForSelected()">
            
            <button class="add-element-btn" onclick="removeImageBackground()" style="background: #9f7aea; width: 100%;">
              🧼 Remover Fundo da Imagem
            </button>
          </div>
          
          <div class="size-controls">
            <div>
              <label for="imageWidth">Largura</label>
              <input type="range" id="imageWidth" min="50" max="600" value="200" onchange="updateSelectedElement()">
              <span id="imageWidthValue">200px</span>
            </div>
            <div>
              <label for="imageHeight">Altura</label>
              <input type="range" id="imageHeight" min="50" max="600" value="150" onchange="updateSelectedElement()">
              <span id="imageHeightValue">150px</span>
            </div>
          </div>
        </div>

        <div id="priceControls" style="display: none;">
          <label for="priceText">Preço</label>
          <input type="text" id="priceText" placeholder="Ex: R$ 79,90" onchange="updateSelectedElement()">
          
          <div class="color-font-controls">
            <div class="color-picker">
              <label for="priceColor">Cor do Preço</label>
              <input type="color" id="priceColor" value="#e53e3e" onchange="updateSelectedElement()">
            </div>
            <div class="font-selector">
              <label for="priceFontSize">Tamanho da Fonte</label>
              <input type="range" id="priceFontSize" min="20" max="60" value="35" onchange="updateSelectedElement()">
              <span id="priceFontSizeValue">35px</span>
            </div>
          </div>
          
          <label for="priceFontFamily">Família da Fonte</label>
          <select id="priceFontFamily" onchange="updateSelectedElement()">
            <option value="Arial, sans-serif">Arial</option>
            <option value="Helvetica, sans-serif">Helvetica</option>
            <option value="Georgia, serif">Georgia</option>
            <option value="'Times New Roman', serif">Times New Roman</option>
            <option value="Verdana, sans-serif">Verdana</option>
            <option value="Impact, sans-serif">Impact</option>
            <option value="'Comic Sans MS', cursive">Comic Sans MS</option>
            <option value="'Trebuchet MS', sans-serif">Trebuchet MS</option>
            <option value="Roboto, sans-serif">Roboto</option>
            <option value="'Open Sans', sans-serif">Open Sans</option>
            <option value="Lato, sans-serif">Lato</option>
            <option value="Montserrat, sans-serif">Montserrat</option>
            <option value="Poppins, sans-serif">Poppins</option>
            <option value="Oswald, sans-serif">Oswald</option>
            <option value="Raleway, sans-serif">Raleway</option>
            <option value="Ubuntu, sans-serif">Ubuntu</option>
            <option value="Nunito, sans-serif">Nunito</option>
            <option value="'Source Sans Pro', sans-serif">Source Sans Pro</option>
            <option value="'Playfair Display', serif">Playfair Display</option>
            <option value="Merriweather, serif">Merriweather</option>
          </select>
          
          <label for="priceWeight">Peso da Fonte</label>
          <select id="priceWeight" onchange="updateSelectedElement()">
            <option value="normal">Normal</option>
            <option value="bold" selected>Negrito</option>
            <option value="lighter">Fino</option>
          </select>
        </div>
      </div>
    </div>

    <div class="canvas-area">
      <div class="canvas" id="canvas">
        <div class="draggable-element draggable-text" style="top: 50px; left: 50px;" onclick="selectElement(this)">
          Clique para editar este texto
          <div class="resize-handle" onmousedown="startResize(event, this.parentElement)"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal de Download -->
  <div class="download-modal" id="downloadModal">
    <div class="download-content">
      <h3>📥 Opções de Download</h3>
      
      <div class="size-options">
        <div class="size-option" data-size="1080x1080" onclick="selectSize(this)">
          <h4>📱 Instagram Post</h4>
          <p>1080 x 1080 pixels</p>
        </div>
        <div class="size-option" data-size="1000x1000" onclick="selectSize(this)">
          <h4>🔲 Quadrado</h4>
          <p>1000 x 1000 pixels</p>
        </div>
        <div class="size-option" data-size="1920x1080" onclick="selectSize(this)">
          <h4>🖥️ Full HD</h4>
          <p>1920 x 1080 pixels</p>
        </div>
        <div class="size-option selected" data-size="current" onclick="selectSize(this)">
          <h4>📐 Tamanho Atual</h4>
          <p id="currentSizeText">800 x 500 pixels</p>
        </div>
      </div>

      <div class="format-options">
        <div class="format-btn selected" data-format="png" onclick="selectFormat(this)">
          🖼️ PNG
        </div>
        <div class="format-btn" data-format="jpg" onclick="selectFormat(this)">
          📷 JPG
        </div>
      </div>

      <div class="download-actions">
        <button class="download-btn primary" onclick="processDownload()">
          📥 Baixar Imagem
        </button>
        <button class="download-btn secondary" onclick="closeDownloadModal()">
          ❌ Cancelar
        </button>
      </div>
    </div>
  </div>

  <script>
    let selectedElement = null;
    let isDragging = false;
    let isResizing = false;
    let dragOffset = { x: 0, y: 0 };
    let elementCounter = 0;
    let selectedDownloadSize = 'current';
    let selectedDownloadFormat = 'png';

    // Detectar se está offline
    function updateOnlineStatus() {
      const indicator = document.getElementById('offlineIndicator');
      if (navigator.onLine) {
        indicator.style.display = 'none';
      } else {
        indicator.style.display = 'block';
      }
    }

    window.addEventListener('online', updateOnlineStatus);
    window.addEventListener('offline', updateOnlineStatus);
    updateOnlineStatus();

    // Selecionar elemento
    function selectElement(element) {
      // Remove seleção anterior
      if (selectedElement) {
        selectedElement.classList.remove('selected');
      }
      
      // Seleciona novo elemento
      selectedElement = element;
      element.classList.add('selected');
      
      // Mostra controles
      showElementControls(element);
    }

    // Mostrar controles do elemento
    function showElementControls(element) {
      const controls = document.getElementById('elementControls');
      const textControls = document.getElementById('textControls');
      const imageControls = document.getElementById('imageControls');
      const priceControls = document.getElementById('priceControls');
      
      controls.classList.add('active');
      
      // Esconder todos os controles primeiro
      textControls.style.display = 'none';
      imageControls.style.display = 'none';
      priceControls.style.display = 'none';
      
      if (element.classList.contains('draggable-text')) {
        textControls.style.display = 'block';
        
        // Preenche valores atuais
        document.getElementById('textContent').value = element.textContent.replace('Clique para editar este texto', '').trim();
        document.getElementById('textColor').value = rgbToHex(getComputedStyle(element).color);
        document.getElementById('fontSize').value = parseInt(getComputedStyle(element).fontSize);
        document.getElementById('fontSizeValue').textContent = getComputedStyle(element).fontSize;
        document.getElementById('fontFamily').value = getComputedStyle(element).fontFamily;
      } else if (element.classList.contains('draggable-image')) {
        imageControls.style.display = 'block';
        
        const img = element.querySelector('img');
        if (img) {
          document.getElementById('imageUrl').value = img.src;
          document.getElementById('imageWidth').value = img.width;
          document.getElementById('imageHeight').value = img.height;
          document.getElementById('imageWidthValue').textContent = img.width + 'px';
          document.getElementById('imageHeightValue').textContent = img.height + 'px';
        }
      } else if (element.classList.contains('draggable-price')) {
        priceControls.style.display = 'block';
        
        // Preenche valores atuais do preço
        document.getElementById('priceText').value = element.textContent.trim();
        document.getElementById('priceColor').value = rgbToHex(getComputedStyle(element).color);
        document.getElementById('priceFontSize').value = parseInt(getComputedStyle(element).fontSize);
        document.getElementById('priceFontSizeValue').textContent = getComputedStyle(element).fontSize;
        document.getElementById('priceFontFamily').value = getComputedStyle(element).fontFamily;
        document.getElementById('priceWeight').value = getComputedStyle(element).fontWeight === '700' ? 'bold' : getComputedStyle(element).fontWeight;
      }
    }

    // Converter RGB para HEX
    function rgbToHex(rgb) {
      const result = rgb.match(/\d+/g);
      if (result) {
        return "#" + ((1 << 24) + (parseInt(result[0]) << 16) + (parseInt(result[1]) << 8) + parseInt(result[2])).toString(16).slice(1);
      }
      return "#333333";
    }

    // Atualizar elemento selecionado
    function updateSelectedElement() {
      if (!selectedElement) return;
      
      if (selectedElement.classList.contains('draggable-text')) {
        const textContent = document.getElementById('textContent').value;
        const textColor = document.getElementById('textColor').value;
        const fontSize = document.getElementById('fontSize').value;
        const fontFamily = document.getElementById('fontFamily').value;
        
        selectedElement.textContent = textContent || 'Texto vazio';
        selectedElement.style.color = textColor;
        selectedElement.style.fontSize = fontSize + 'px';
        selectedElement.style.fontFamily = fontFamily;
        
        document.getElementById('fontSizeValue').textContent = fontSize + 'px';
        
        // Re-adiciona o handle de resize
        if (!selectedElement.querySelector('.resize-handle')) {
          const handle = document.createElement('div');
          handle.className = 'resize-handle';
          handle.onmousedown = (e) => startResize(e, selectedElement);
          selectedElement.appendChild(handle);
        }
      } else if (selectedElement.classList.contains('draggable-image')) {
        const imageUrl = document.getElementById('imageUrl').value;
        const imageWidth = document.getElementById('imageWidth').value;
        const imageHeight = document.getElementById('imageHeight').value;
        
        const img = selectedElement.querySelector('img');
        if (img && imageUrl) {
          img.src = imageUrl;
          img.width = imageWidth;
          img.height = imageHeight;
          
          document.getElementById('imageWidthValue').textContent = imageWidth + 'px';
          document.getElementById('imageHeightValue').textContent = imageHeight + 'px';
        }
      } else if (selectedElement.classList.contains('draggable-price')) {
        const priceText = document.getElementById('priceText').value;
        const priceColor = document.getElementById('priceColor').value;
        const priceFontSize = document.getElementById('priceFontSize').value;
        const priceFontFamily = document.getElementById('priceFontFamily').value;
        const priceWeight = document.getElementById('priceWeight').value;
        
        selectedElement.textContent = priceText || 'R$ 0,00';
        selectedElement.style.color = priceColor;
        selectedElement.style.fontSize = priceFontSize + 'px';
        selectedElement.style.fontFamily = priceFontFamily;
        selectedElement.style.fontWeight = priceWeight;
        
        document.getElementById('priceFontSizeValue').textContent = priceFontSize + 'px';
        
        // Re-adiciona o handle de resize
        if (!selectedElement.querySelector('.resize-handle')) {
          const handle = document.createElement('div');
          handle.className = 'resize-handle';
          handle.onmousedown = (e) => startResize(e, selectedElement);
          selectedElement.appendChild(handle);
        }
      }
      
      updatePreview();
    }

    // Função para atualizar a visualização
    function updatePreview() {
      const canvas = document.getElementById('canvas');
      const preview = document.getElementById('previewCanvas');
      
      // Clonar o conteúdo do canvas principal
      preview.innerHTML = canvas.innerHTML;
      
      // Aplicar o mesmo estilo de fundo
      preview.style.background = getComputedStyle(canvas).background;
      preview.style.backgroundImage = getComputedStyle(canvas).backgroundImage;
      preview.style.backgroundSize = getComputedStyle(canvas).backgroundSize;
      preview.style.backgroundPosition = getComputedStyle(canvas).backgroundPosition;
      preview.style.backgroundRepeat = getComputedStyle(canvas).backgroundRepeat;
      
      // Remover interatividade dos elementos clonados
      const previewElements = preview.querySelectorAll('.draggable-element');
      previewElements.forEach(element => {
        element.onclick = null;
        element.style.cursor = 'default';
        element.classList.remove('selected');
        
        // Remover handles de resize
        const handle = element.querySelector('.resize-handle');
        if (handle) {
          handle.remove();
        }
      });
    }

    // Adicionar elemento de texto
    function addTextElement() {
      elementCounter++;
      const canvas = document.getElementById('canvas');
      const textElement = document.createElement('div');
      textElement.className = 'draggable-element draggable-text';
      textElement.style.top = (50 + elementCounter * 30) + 'px';
      textElement.style.left = (50 + elementCounter * 30) + 'px';
      textElement.textContent = 'Novo texto ' + elementCounter;
      textElement.onclick = () => selectElement(textElement);
      
      const handle = document.createElement('div');
      handle.className = 'resize-handle';
      handle.onmousedown = (e) => startResize(e, textElement);
      textElement.appendChild(handle);
      
      canvas.appendChild(textElement);
      selectElement(textElement);
      updatePreview();
    }

    // Adicionar elemento de imagem
    function addImageElement() {
      elementCounter++;
      const canvas = document.getElementById('canvas');
      const imageElement = document.createElement('div');
      imageElement.className = 'draggable-element draggable-image';
      imageElement.style.top = (50 + elementCounter * 30) + 'px';
      imageElement.style.left = (50 + elementCounter * 30) + 'px';
      
      const img = document.createElement('img');
      img.src = 'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="200" height="150" viewBox="0 0 200 150"%3E%3Crect width="200" height="150" fill="%23f0f0f0" stroke="%23ccc" stroke-width="2"/%3E%3Ctext x="100" y="75" text-anchor="middle" font-family="Arial" font-size="14" fill="%23666"%3EImagem ' + elementCounter + '%3C/text%3E%3C/svg%3E';
      img.width = 200;
      img.height = 150;
      img.style.width = '100%';
      img.style.height = '100%';
      img.style.objectFit = 'cover';
      
      imageElement.appendChild(img);
      imageElement.onclick = () => selectElement(imageElement);
      
      const handle = document.createElement('div');
      handle.className = 'resize-handle';
      handle.onmousedown = (e) => startResize(e, imageElement);
      imageElement.appendChild(handle);
      
      canvas.appendChild(imageElement);
      selectElement(imageElement);
      updatePreview();
    }

    // Adicionar elemento de preço
    function addPriceElement() {
      elementCounter++;
      const canvas = document.getElementById('canvas');
      const priceElement = document.createElement('div');
      priceElement.className = 'draggable-element draggable-price';
      priceElement.style.top = (50 + elementCounter * 30) + 'px';
      priceElement.style.left = (50 + elementCounter * 30) + 'px';
      priceElement.textContent = 'R$ 0,00';
      priceElement.onclick = () => selectElement(priceElement);
      
      const handle = document.createElement('div');
      handle.className = 'resize-handle';
      handle.onmousedown = (e) => startResize(e, priceElement);
      priceElement.appendChild(handle);
      
      canvas.appendChild(priceElement);
      selectElement(priceElement);
    }

    // Atualizar tamanho do canvas
    function updateCanvasSize() {
      const canvas = document.getElementById('canvas');
      const width = document.getElementById('canvasWidth').value;
      const height = document.getElementById('canvasHeight').value;
      
      canvas.style.width = width + 'px';
      canvas.style.height = height + 'px';
    }

    // Sistema de arrastar
    document.addEventListener('mousedown', function(e) {
      const element = e.target.closest('.draggable-element');
      if (element && !e.target.classList.contains('resize-handle')) {
        isDragging = true;
        selectElement(element);
        
        const rect = element.getBoundingClientRect();
        const canvasRect = document.getElementById('canvas').getBoundingClientRect();
        
        dragOffset.x = e.clientX - rect.left;
        dragOffset.y = e.clientY - rect.top;
        
        e.preventDefault();
      }
    });

    document.addEventListener('mousemove', function(e) {
      if (isDragging && selectedElement) {
        const canvasRect = document.getElementById('canvas').getBoundingClientRect();
        
        let newX = e.clientX - canvasRect.left - dragOffset.x;
        let newY = e.clientY - canvasRect.top - dragOffset.y;
        
        // Limitar dentro do canvas
        newX = Math.max(0, Math.min(newX, canvasRect.width - selectedElement.offsetWidth));
        newY = Math.max(0, Math.min(newY, canvasRect.height - selectedElement.offsetHeight));
        
        selectedElement.style.left = newX + 'px';
        selectedElement.style.top = newY + 'px';
      }
    });

    document.addEventListener('mouseup', function() {
      isDragging = false;
      isResizing = false;
    });

    // Sistema de redimensionar
    function startResize(e, element) {
      e.stopPropagation();
      isResizing = true;
      selectedElement = element;
      
      const startX = e.clientX;
      const startY = e.clientY;
      const startWidth = element.offsetWidth;
      const startHeight = element.offsetHeight;
      
      function doResize(e) {
        if (!isResizing) return;
        
        const newWidth = startWidth + (e.clientX - startX);
        const newHeight = startHeight + (e.clientY - startY);
        
        element.style.width = Math.max(50, newWidth) + 'px';
        element.style.height = Math.max(30, newHeight) + 'px';
        
        // Atualizar controles se for imagem
        if (element.classList.contains('draggable-image')) {
          const img = element.querySelector('img');
          if (img) {
            document.getElementById('imageWidth').value = newWidth;
            document.getElementById('imageHeight').value = newHeight;
            document.getElementById('imageWidthValue').textContent = newWidth + 'px';
            document.getElementById('imageHeightValue').textContent = newHeight + 'px';
          }
        }
      }
      
      function stopResize() {
        isResizing = false;
        document.removeEventListener('mousemove', doResize);
        document.removeEventListener('mouseup', stopResize);
      }
      
      document.addEventListener('mousemove', doResize);
      document.addEventListener('mouseup', stopResize);
    }

    // Selecionar fundo
    function selecionarFundo(value) {
      const canvas = document.getElementById('canvas');
      
      if (value === 'upload') {
        document.getElementById('bgUpload').click();
      } else if (value.startsWith('http')) {
        // Fundos com imagem
        canvas.style.backgroundImage = `url('${value}')`;
        canvas.style.backgroundSize = 'contain';
        canvas.style.backgroundPosition = 'center';
        canvas.style.backgroundRepeat = 'no-repeat';
      } else if (value.startsWith('gradient-')) {
        // Fundos gradientes
        canvas.style.backgroundImage = '';
        switch(value) {
          case 'gradient-blue':
            canvas.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
            break;
          case 'gradient-purple':
            canvas.style.background = 'linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)';
            break;
          case 'gradient-pink':
            canvas.style.background = 'linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%)';
            break;
          case 'gradient-orange':
            canvas.style.background = 'linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%)';
            break;
          case 'gradient-green':
            canvas.style.background = 'linear-gradient(135deg, #a8e6cf 0%, #dcedc1 100%)';
            break;
          case 'gradient-sunset':
            canvas.style.background = 'linear-gradient(135deg, #ff6b6b 0%, #feca57 100%)';
            break;
          case 'gradient-ocean':
            canvas.style.background = 'linear-gradient(135deg, #74b9ff 0%, #0984e3 100%)';
            break;
          case 'gradient-forest':
            canvas.style.background = 'linear-gradient(135deg, #00b894 0%, #00cec9 100%)';
            break;
        }
      } else if (value.startsWith('solid-')) {
        // Fundos sólidos
        canvas.style.backgroundImage = '';
        switch(value) {
          case 'solid-white':
            canvas.style.background = '#ffffff';
            break;
          case 'solid-black':
            canvas.style.background = '#000000';
            break;
          case 'solid-red':
            canvas.style.background = '#e74c3c';
            break;
          case 'solid-blue':
            canvas.style.background = '#3498db';
            break;
          case 'solid-green':
            canvas.style.background = '#2ecc71';
            break;
          case 'solid-yellow':
            canvas.style.background = '#f1c40f';
            break;
          case 'solid-purple':
            canvas.style.background = '#9b59b6';
            break;
          case 'solid-pink':
            canvas.style.background = '#e91e63';
            break;
        }
      } else if (value.startsWith('pattern-')) {
        // Fundos com padrões
        canvas.style.backgroundImage = '';
        switch(value) {
          case 'pattern-dots':
            canvas.style.background = 'radial-gradient(circle, #667eea 2px, transparent 2px)';
            canvas.style.backgroundSize = '20px 20px';
            canvas.style.backgroundColor = '#f8f9fa';
            break;
          case 'pattern-stripes':
            canvas.style.background = 'repeating-linear-gradient(45deg, #667eea, #667eea 10px, #f8f9fa 10px, #f8f9fa 20px)';
            break;
          case 'pattern-grid':
            canvas.style.background = 'linear-gradient(#667eea 1px, transparent 1px), linear-gradient(90deg, #667eea 1px, transparent 1px)';
            canvas.style.backgroundSize = '20px 20px';
            canvas.style.backgroundColor = '#f8f9fa';
            break;
          case 'pattern-triangles':
            canvas.style.background = 'linear-gradient(135deg, #667eea 25%, transparent 25%), linear-gradient(225deg, #667eea 25%, transparent 25%), linear-gradient(45deg, #667eea 25%, transparent 25%), linear-gradient(315deg, #667eea 25%, #f8f9fa 25%)';
            canvas.style.backgroundSize = '20px 20px';
            break;
          case 'pattern-hexagon':
            canvas.style.background = 'radial-gradient(circle at 50% 50%, #667eea 50%, transparent 50%), radial-gradient(circle at 25% 25%, #667eea 50%, transparent 50%), radial-gradient(circle at 75% 75%, #667eea 50%, transparent 50%)';
            canvas.style.backgroundSize = '40px 40px';
            canvas.style.backgroundColor = '#f8f9fa';
            break;
          case 'pattern-waves':
            canvas.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
            canvas.style.backgroundImage = 'radial-gradient(circle at 20% 80%, rgba(255,255,255,0.1) 0%, transparent 50%), radial-gradient(circle at 80% 20%, rgba(255,255,255,0.1) 0%, transparent 50%)';
            break;
        }
      }
    }

    // Upload de fundo
    function uploadBackground() {
      const file = document.getElementById('bgUpload').files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          const canvas = document.getElementById('canvas');
          canvas.style.backgroundImage = `url('${e.target.result}')`;
          canvas.style.backgroundSize = 'contain';
          canvas.style.backgroundPosition = 'center';
          canvas.style.backgroundRepeat = 'no-repeat';
        };
        reader.readAsDataURL(file);
      }
    }

    // Adicionar produto da galeria
    function addProductImage(imageUrl) {
      elementCounter++;
      const canvas = document.getElementById('canvas');
      const imageElement = document.createElement('div');
      imageElement.className = 'draggable-element draggable-image';
      imageElement.style.top = (50 + elementCounter * 30) + 'px';
      imageElement.style.left = (50 + elementCounter * 30) + 'px';
      
      const img = document.createElement('img');
      img.src = imageUrl;
      img.width = 150;
      img.height = 150;
      img.style.width = '100%';
      img.style.height = '100%';
      img.style.objectFit = 'cover';
      
      imageElement.appendChild(img);
      imageElement.onclick = () => selectElement(imageElement);
      
      const handle = document.createElement('div');
      handle.className = 'resize-handle';
      handle.onmousedown = (e) => startResize(e, imageElement);
      imageElement.appendChild(handle);
      
      canvas.appendChild(imageElement);
      selectElement(imageElement);
      updatePreview();
    }

    // Upload de produtos para galeria
    function uploadProduct() {
      const files = document.getElementById('productUpload').files;
      const gallery = document.getElementById('productGallery');
      
      Array.from(files).forEach(file => {
        if (file.type.startsWith('image/')) {
          const reader = new FileReader();
          reader.onload = function(e) {
            const productItem = document.createElement('div');
            productItem.className = 'product-item';
            productItem.onclick = () => addProductImage(e.target.result);
            
            const img = document.createElement('img');
            img.src = e.target.result;
            img.alt = file.name;
            
            const span = document.createElement('span');
            span.textContent = file.name.substring(0, 15) + (file.name.length > 15 ? '...' : '');
            
            productItem.appendChild(img);
            productItem.appendChild(span);
            gallery.appendChild(productItem);
          };
          reader.readAsDataURL(file);
        }
      });
    }

    // Upload de imagem para elemento selecionado
    function uploadImageForSelected() {
      const file = document.getElementById('imageUpload').files[0];
      if (file && selectedElement && selectedElement.classList.contains('draggable-image')) {
        const reader = new FileReader();
        reader.onload = function(e) {
          const img = selectedElement.querySelector('img');
          if (img) {
            img.src = e.target.result;
            document.getElementById('imageUrl').value = e.target.result;
          }
        };
        reader.readAsDataURL(file);
      }
    }

    // Função para baixar o canvas com tamanho específico
    function downloadCanvasWithSize(format = 'png', targetWidth, targetHeight) {
      const canvas = document.getElementById('canvas');
      
      // Criar um canvas temporário em alta resolução
      const tempCanvas = document.createElement('canvas');
      const ctx = tempCanvas.getContext('2d');
      
      // Definir dimensões do canvas
      tempCanvas.width = targetWidth;
      tempCanvas.height = targetHeight;
      
      // Calcular escala para ajustar o conteúdo
      const scaleX = targetWidth / canvas.offsetWidth;
      const scaleY = targetHeight / canvas.offsetHeight;
      
      // Escalar o contexto
      ctx.scale(scaleX, scaleY);
      
      // Preencher com fundo branco se não houver imagem de fundo
      ctx.fillStyle = '#ffffff';
      ctx.fillRect(0, 0, canvas.offsetWidth, canvas.offsetHeight);
      
      // Se houver imagem de fundo, desenhar ela primeiro
      const bgImage = getComputedStyle(canvas).backgroundImage;
      if (bgImage && bgImage !== 'none') {
        const img = new Image();
        img.crossOrigin = 'anonymous';
        img.onload = function() {
          ctx.drawImage(img, 0, 0, canvas.offsetWidth, canvas.offsetHeight);
          drawElementsOnCanvas(ctx, canvas, tempCanvas, format);
        };
        img.src = bgImage.slice(5, -2); // Remove 'url("' e '")'
      } else {
        drawElementsOnCanvas(ctx, canvas, tempCanvas, format);
      }
    }

    // Função para baixar o canvas como imagem HD (compatibilidade)
    function downloadCanvas(format = 'png') {
      showDownloadOptions();
    }

    function drawElementsOnCanvas(ctx, canvas, tempCanvas, format) {
      const elements = canvas.querySelectorAll('.draggable-element');
      let loadedImages = 0;
      const totalImages = Array.from(elements).filter(el => el.classList.contains('draggable-image')).length;
      
      if (totalImages === 0) {
        // Se não há imagens, desenhar apenas textos e baixar
        drawTextsAndDownload(ctx, canvas, tempCanvas, format);
        return;
      }
      
      elements.forEach(element => {
        if (element.classList.contains('draggable-text') || element.classList.contains('draggable-price')) {
          // Desenhar texto
          const rect = element.getBoundingClientRect();
          const canvasRect = canvas.getBoundingClientRect();
          
          const x = rect.left - canvasRect.left;
          const y = rect.top - canvasRect.top;
          
          ctx.font = `${getComputedStyle(element).fontWeight} ${getComputedStyle(element).fontSize} ${getComputedStyle(element).fontFamily}`;
          ctx.fillStyle = getComputedStyle(element).color;
          ctx.textAlign = 'left';
          ctx.textBaseline = 'top';
          
          const text = element.textContent;
          const lines = text.split('\n');
          const lineHeight = parseInt(getComputedStyle(element).fontSize) * 1.2;
          
          lines.forEach((line, index) => {
            ctx.fillText(line, x + 10, y + 10 + (index * lineHeight));
          });
        } else if (element.classList.contains('draggable-image')) {
          // Desenhar imagem
          const img = element.querySelector('img');
          if (img) {
            const tempImg = new Image();
            tempImg.crossOrigin = 'anonymous';
            tempImg.onload = function() {
              const rect = element.getBoundingClientRect();
              const canvasRect = canvas.getBoundingClientRect();
              
              const x = rect.left - canvasRect.left;
              const y = rect.top - canvasRect.top;
              const width = rect.width;
              const height = rect.height;
              
              ctx.drawImage(tempImg, x, y, width, height);
              
              loadedImages++;
              if (loadedImages === totalImages) {
                // Todas as imagens foram carregadas, fazer download
                downloadImage(tempCanvas, format);
              }
            };
            tempImg.src = img.src;
          }
        }
      });
    }

    function drawTextsAndDownload(ctx, canvas, tempCanvas, format) {
      const elements = canvas.querySelectorAll('.draggable-element');
      
      elements.forEach(element => {
        if (element.classList.contains('draggable-text') || element.classList.contains('draggable-price')) {
          const rect = element.getBoundingClientRect();
          const canvasRect = canvas.getBoundingClientRect();
          
          const x = rect.left - canvasRect.left;
          const y = rect.top - canvasRect.top;
          
          ctx.font = `${getComputedStyle(element).fontWeight} ${getComputedStyle(element).fontSize} ${getComputedStyle(element).fontFamily}`;
          ctx.fillStyle = getComputedStyle(element).color;
          ctx.textAlign = 'left';
          ctx.textBaseline = 'top';
          
          const text = element.textContent;
          const lines = text.split('\n');
          const lineHeight = parseInt(getComputedStyle(element).fontSize) * 1.2;
          
          lines.forEach((line, index) => {
            ctx.fillText(line, x + 10, y + 10 + (index * lineHeight));
          });
        }
      });
      
      downloadImage(tempCanvas, format);
    }

    function downloadImage(canvas, format = 'png') {
      const link = document.createElement('a');
      const timestamp = new Date().getTime();
      
      if (format === 'jpg') {
        link.download = `design-editor-hd-${timestamp}.jpg`;
        link.href = canvas.toDataURL('image/jpeg', 0.95); // Alta qualidade JPG
      } else {
        link.download = `design-editor-hd-${timestamp}.png`;
        link.href = canvas.toDataURL('image/png');
      }
      
      link.click();
    }

    // Função para remover elemento selecionado
    function removeSelectedElement() {
      if (selectedElement) {
        selectedElement.remove();
        selectedElement = null;
        
        // Esconder controles
        const controls = document.getElementById('elementControls');
        controls.classList.remove('active');
        
        // Mostrar mensagem de confirmação
        alert('Elemento removido com sucesso!');
      } else {
        alert('Selecione um elemento primeiro para removê-lo.');
      }
    }

    // Função para remover fundo da imagem usando algoritmo de processamento
    function removeImageBackground() {
      if (!selectedElement || !selectedElement.classList.contains('draggable-image')) {
        alert('Selecione uma imagem primeiro para remover o fundo.');
        return;
      }
      
      const img = selectedElement.querySelector('img');
      if (!img) return;
      
      // Criar canvas temporário para processamento
      const canvas = document.createElement('canvas');
      const ctx = canvas.getContext('2d');
      
      // Criar nova imagem para carregar
      const tempImg = new Image();
      tempImg.crossOrigin = 'anonymous';
      
      tempImg.onload = function() {
        canvas.width = tempImg.width;
        canvas.height = tempImg.height;
        
        // Desenhar imagem no canvas
        ctx.drawImage(tempImg, 0, 0);
        
        // Obter dados da imagem
        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
        const data = imageData.data;
        
        // Algoritmo simples de remoção de fundo baseado na cor predominante das bordas
        const cornerColors = [
          [data[0], data[1], data[2]], // Canto superior esquerdo
          [data[(canvas.width - 1) * 4], data[(canvas.width - 1) * 4 + 1], data[(canvas.width - 1) * 4 + 2]], // Canto superior direito
          [data[(canvas.height - 1) * canvas.width * 4], data[(canvas.height - 1) * canvas.width * 4 + 1], data[(canvas.height - 1) * canvas.width * 4 + 2]], // Canto inferior esquerdo
          [data[((canvas.height - 1) * canvas.width + canvas.width - 1) * 4], data[((canvas.height - 1) * canvas.width + canvas.width - 1) * 4 + 1], data[((canvas.height - 1) * canvas.width + canvas.width - 1) * 4 + 2]] // Canto inferior direito
        ];
        
        // Calcular cor média dos cantos (assumindo que é o fundo)
        const avgColor = [
          Math.round((cornerColors[0][0] + cornerColors[1][0] + cornerColors[2][0] + cornerColors[3][0]) / 4),
          Math.round((cornerColors[0][1] + cornerColors[1][1] + cornerColors[2][1] + cornerColors[3][1]) / 4),
          Math.round((cornerColors[0][2] + cornerColors[1][2] + cornerColors[2][2] + cornerColors[3][2]) / 4)
        ];
        
        // Tolerância para remoção de cor similar
        const tolerance = 50;
        
        // Processar cada pixel
        for (let i = 0; i < data.length; i += 4) {
          const r = data[i];
          const g = data[i + 1];
          const b = data[i + 2];
          
          // Calcular diferença de cor
          const colorDiff = Math.sqrt(
            Math.pow(r - avgColor[0], 2) +
            Math.pow(g - avgColor[1], 2) +
            Math.pow(b - avgColor[2], 2)
          );
          
          // Se a cor é similar ao fundo, tornar transparente
          if (colorDiff < tolerance) {
            data[i + 3] = 0; // Alpha = 0 (transparente)
          }
        }
        
        // Aplicar os dados processados de volta ao canvas
        ctx.putImageData(imageData, 0, 0);
        
        // Converter para data URL e aplicar à imagem
        const processedImageUrl = canvas.toDataURL('image/png');
        img.src = processedImageUrl;
        
        // Atualizar o campo URL se estiver visível
        const imageUrlField = document.getElementById('imageUrl');
        if (imageUrlField) {
          imageUrlField.value = processedImageUrl;
        }
        
        alert('Fundo removido! O resultado pode variar dependendo da complexidade da imagem.');
      };
      
      tempImg.onerror = function() {
        alert('Erro ao processar a imagem. Tente com uma imagem diferente.');
      };
      
      // Carregar a imagem
      tempImg.src = img.src;
    }

    // Adicionar tecla Delete para remover elementos
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Delete' && selectedElement) {
        removeSelectedElement();
      }
    });

    // Funções do Modal de Download
    function showDownloadOptions() {
      const modal = document.getElementById('downloadModal');
      const canvas = document.getElementById('canvas');
      const currentSizeText = document.getElementById('currentSizeText');
      
      // Atualizar texto do tamanho atual
      currentSizeText.textContent = `1000 x 1000 pixels`;
      
      modal.classList.add('active');
    }

    function closeDownloadModal() {
      const modal = document.getElementById('downloadModal');
      modal.classList.remove('active');
    }

    function selectSize(element) {
      // Remove seleção anterior
      document.querySelectorAll('.size-option').forEach(opt => opt.classList.remove('selected'));
      
      // Adiciona seleção atual
      element.classList.add('selected');
      selectedDownloadSize = element.dataset.size;
    }

    function selectFormat(element) {
      // Remove seleção anterior
      document.querySelectorAll('.format-btn').forEach(btn => btn.classList.remove('selected'));
      
      // Adiciona seleção atual
      element.classList.add('selected');
      selectedDownloadFormat = element.dataset.format;
    }

    function processDownload() {
      closeDownloadModal();
      
      // Determinar dimensões
      let width, height;
      const canvas = document.getElementById('canvas');
      
      switch(selectedDownloadSize) {
        case '1080x1080':
          width = 1080;
          height = 1080;
          break;
        case '1000x1000':
          width = 1000;
          height = 1000;
          break;
        case '1920x1080':
          width = 1920;
          height = 1080;
          break;
        default: // 'current'
          width = canvas.offsetWidth;
          height = canvas.offsetHeight;
      }
      
      downloadCanvasWithSize(selectedDownloadFormat, width, height);
    }

    // Função para exportar logo diretamente
    function exportLogo() {
      const canvas = document.getElementById('canvas');
      downloadCanvasWithSize('png', 1000, 1000);
    }

    // Fechar modal ao clicar fora
    document.getElementById('downloadModal').addEventListener('click', function(e) {
      if (e.target === this) {
        closeDownloadModal();
      }
    });

    // Selecionar primeiro elemento por padrão
    window.addEventListener('load', function() {
      const firstElement = document.querySelector('.draggable-element');
      if (firstElement) {
        selectElement(firstElement);
      }
    });
  </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9686d4f397fbc491',t:'MTc1NDA2Njk5OC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
